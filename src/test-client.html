<!DOCTYPE html>
<html>
<head>
    <title>Waha Live Monitor</title>
    <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        #feed { border: 1px solid #ccc; background: white; padding: 10px; height: 400px; overflow-y: scroll; border-radius: 8px; }
        .post { padding: 10px; border-bottom: 1px solid #eee; transition: background 0.3s; }
        .post.deleted { background: #ffcccc; text-decoration: line-through; color: #888; }
        .status { font-size: 0.8em; color: #666; margin-left: 10px; }
    </style>
</head>
<body>
    <h2> WhatsApp Live Monitor</h2>
    <div id="feed"></div>

    <script>
        const socket = io('http://localhost:3001');
        const feed = document.getElementById('feed');

        socket.on('connect', () => {
            console.log('Connected to NestJS!');
        });

        socket.on('new_post', (data) => {
            console.log('New Post:', data);
            
            const div = document.createElement('div');
            div.id = `msg-${data.whatsappId}`
            div.className = 'post';
            div.innerHTML = `
                <b>${data.body}</b> 
                <span class="status" id="status-${data.whatsappId}">(${data.status})</span>
            `;
            feed.prepend(div);
        });

        socket.on('post_update', (data) => {
            console.log('Status Update:', data);
            const statusSpan = document.getElementById(`status-${data.id}`);
            if (statusSpan) {
                statusSpan.innerText = `(${data.status})`;
                statusSpan.style.color = data.status === 'read' ? 'blue' : 'gray';
            }
        });

        socket.on('post_deleted', (data) => {
            console.log('Deleted:', data);
            const msgDiv = document.getElementById(`msg-${data.id}`);
            if (msgDiv) {
                msgDiv.className = 'post deleted';
                msgDiv.innerHTML += ' <b style="color:red">[DELETED]</b>';
                
                setTimeout(() => msgDiv.remove(), 2000);
            }
        });
    </script>
</body>
</html>